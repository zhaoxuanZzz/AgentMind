# 特性规范：前端重构 - 基于 @ant-design/x-sdk

**特性ID**：001-frontend-refactor  
**创建日期**：2026-01-24  
**目标版本**：v2.0.0  
**所有者**：前端团队  

## 1. 特性概述

重构 AgentMind 前端应用，使用 `@ant-design/x-sdk` 作为核心 AI 对话流处理库，采用清新淡雅的浅色主题设计，提供现代化、简洁美观的用户界面。

### 业务价值
- **提升用户体验**：更流畅的 AI 对话交互，更清晰的信息展示
- **降低维护成本**：模块化组件设计，提高代码可维护性
- **统一技术栈**：采用 Ant Design 生态系统，减少学习成本
- **增强性能**：优化渲染性能，支持长消息列表场景

### 用户故事
- 作为用户，我希望看到简洁清爽的界面，而不是当前较为复杂的深色主题
- 作为用户，我希望消息流式响应更流畅，能清楚看到 AI 的思考过程
- 作为用户，我希望在移动设备上也能流畅使用对话功能
- 作为开发者，我希望组件结构清晰，便于后续功能扩展

## 2. 功能需求

### 2.1 核心功能保留
- ✅ AI 对话流式响应（使用 XRequest 替代 EventSource）
- ✅ 会话管理（新建、删除、切换对话）
- ✅ 知识库选择（在对话中使用知识库）
- ✅ 模型选择（切换不同 LLM 提供商和模型）
- ✅ 消息历史记录
- ✅ Markdown 渲染和代码高亮

### 2.2 新增功能
- ✨ 思考过程可视化（展示 AI 的推理步骤）
- ✨ 工具调用展示（显示 AI 使用的工具和结果）
- ✨ 流畅的页面过渡动画
- ✨ 响应式布局（移动端、平板、桌面适配）

### 2.3 简化/延后功能
- 🔄 深思模式 → 简化为开关，收敛到设置面板
- 🔄 角色预设 → 移至知识库页面独立管理
- 🔄 搜索提供商选择 → 收敛到设置面板
- ⏳ 暗色模式 → 第一阶段不实现，仅浅色主题

## 3. 技术设计

### 3.1 技术栈
- **核心库**：React 18 + TypeScript 5.x
- **UI 框架**：Ant Design 6.x（升级以支持 @ant-design/x）
- **AI 组件**：@ant-design/x 2.x（AI 专用 UI 组件）+ @ant-design/x-sdk（流式处理）
- **动画**：framer-motion 11.x
- **Markdown**：react-markdown + highlight.js
- **构建工具**：Vite 5.x
- **状态管理**：React Hooks（useState、useReducer）

### 3.2 架构设计

#### 组件分层
```
pages/                    # 页面级组件
├── ChatPage/            # 对话页面
│   ├── components/      # 页面私有组件
│   └── hooks/          # 页面私有 hooks
├── KnowledgePage/       # 知识库页面
└── ...

components/              # 全局共享组件
├── MessageBubble/      # 消息气泡
├── StreamingText/      # 流式文本显示
└── ...

hooks/                   # 全局共享 hooks
├── useXRequest.ts      # XRequest 封装
└── useStreamChat.ts    # 流式对话逻辑
```

#### 数据流设计
```
User Input → XRequest → Stream Chunks → State Update → UI Render
                ↓
            callbacks:
            - onUpdate: 更新流式内容
            - onSuccess: 完成处理
            - onError: 错误处理
```

### 3.3 流式数据格式

定义统一的流式响应格式（需后端配合）：

```typescript
interface StreamChunk {
  type: 'content' | 'thinking' | 'tool_call' | 'tool_result' | 'done';
  data: {
    content?: string;        // 消息内容
    thinking?: string;       // 思考过程
    tool_name?: string;      // 工具名称
    tool_input?: any;        // 工具输入
    tool_output?: any;       // 工具输出
    metadata?: Record<string, any>;
  };
  timestamp: string;
}
```

## 4. 界面设计

### 4.1 配色方案（清新淡雅）
- **主色**：#1677ff（蚂蚁蓝）
- **主背景**：#ffffff（纯白）
- **次要背景**：#f5f8fc（浅灰蓝）
- **文字色**：#1d2129（深灰）/ #4e5969（中灰）
- **边框色**：#e5e8ef（浅灰）

### 4.2 布局设计

#### 对话页面布局
```
┌────────────────────────────────────────────┐
│  Header: Logo + 导航 + 模型选择            │
├──────────┬─────────────────────────────────┤
│ 会话列表 │  消息区域                       │
│ (280px)  │  - AI/用户消息                  │
│          │  - 思考过程                     │
│          │  - 工具调用                     │
├──────────┴─────────────────────────────────┤
│  输入区：文本框 + 工具栏 + 发送按钮        │
└────────────────────────────────────────────┘
```

#### 知识库页面布局
```
┌────────────────────────────────────────────┐
│  Tabs: 知识库 | 文档 | 角色预设           │
├────────────────────────────────────────────┤
│  卡片网格布局                              │
│  ┌──────┐ ┌──────┐ ┌──────┐               │
│  │ 卡片1│ │ 卡片2│ │ 卡片3│               │
│  └──────┘ └──────┘ └──────┘               │
└────────────────────────────────────────────┘
```

## 5. 非功能需求

### 5.1 性能要求
- **首屏加载**：< 2s（3G 网络）
- **流式响应**：< 100ms 延迟
- **长列表**：支持 1000+ 消息（Phase 4 虚拟滚动）
- **动画帧率**：60 FPS

### 5.2 兼容性要求
- **浏览器**：Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- **设备**：桌面、平板（768px+）、手机（375px+）
- **网络**：支持弱网环境（3G）

### 5.3 可访问性
- 键盘导航支持
- 适当的 ARIA 标签
- 高对比度文本（WCAG AA 标准）

## 6. 约束与依赖

### 6.1 技术约束
- 必须保持与现有后端 API 兼容
- 必须使用 TypeScript 严格模式
- 必须遵循 Ant Design 设计规范
- 暂不支持暗色主题（简化第一阶段）

### 6.2 外部依赖
- **后端 API**：`/api/chat/stream` 需支持流式响应
- **后端 API**：需提供统一的流式数据格式（见 3.3）
- **@ant-design/x-sdk**：依赖 1.x 版本稳定性

### 6.3 已知风险
- XRequest 库的成熟度（需验证生产环境稳定性）
- 流式数据格式变更可能需要前后端同步修改
- 组件拆分可能引入初期的开发复杂度

## 7. 验收标准

### 7.1 功能验收
- [ ] 流式对话正常工作，无卡顿或中断
- [ ] 思考过程和工具调用正确展示
- [ ] 会话切换无数据丢失
- [ ] 知识库选择功能正常
- [ ] 移动端布局正常

### 7.2 性能验收
- [ ] 首屏加载时间 < 2s
- [ ] 消息渲染无明显延迟
- [ ] 页面切换动画流畅（60 FPS）
- [ ] 长对话列表（100+ 消息）无性能问题

### 7.3 代码质量
- [ ] TypeScript 无 any 类型（除必要情况）
- [ ] 组件单一职责，平均 < 200 行
- [ ] 无 ESLint 错误
- [ ] 关键组件有基础测试

## 8. 实施阶段

### Phase 1: 基础架构（Week 1）
- 主题系统配置
- 基础组件库搭建
- 项目结构重组

### Phase 2: 对话页面（Week 2）
- XRequest 集成
- 消息组件开发
- 流式处理逻辑

### Phase 3: 知识库页面（Week 3）
- 知识库列表重构
- 文档管理优化
- 角色预设管理

### Phase 4: 细节优化（Week 4）
- 动画效果
- 响应式布局
- 性能优化
- 测试与修复

## 9. 未来规划

### v2.1（后续迭代）
- 虚拟滚动（react-window）
- 暗色主题支持
- 键盘快捷键
- 消息搜索功能

### v2.2（探索方向）
- 多模态支持（图片、文件）
- 协作功能（分享对话）
- 离线模式
- PWA 支持

---

**相关文档**：
- 详细重构方案：`/前端重构方案.md`
- 实施计划：`/specs/001-frontend-refactor/plan.md`
- 任务分解：`/specs/001-frontend-refactor/tasks.md`（待生成）
