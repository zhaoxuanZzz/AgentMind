<!--
同步影响报告:
====================
版本: 0.0.0 → 1.0.0
创建日期: 2026-01-24
类型: 初始批准

变更内容:
- ✅ 所有占位符已填充为项目特定值
- ✅ 五个核心原则已定义
- ✅ 技术栈约束已记录
- ✅ 开发工作流程已建立

需要更新的模板:
- ✅ plan-template.md: 已更新宪章检查部分（添加AgentMind特定原则）
- ✅ spec-template.md: 已验证与模块化设计和API优先原则一致（无需修改）
- ✅ tasks-template.md: 已更新Setup和Foundational阶段的宪章合规性提醒

后续TODOs: 无
-->

# AgentMind 项目宪章

## 核心原则

### I. 模块化服务设计

**必须强制执行清晰的服务边界和关注点分离**

每个服务模块必须：
- 具有单一、明确定义的职责
- 可独立测试，无需完整应用上下文
- 通过清晰、文档完善的接口公开功能
- 与其他模块保持松散耦合

理由：项目已识别出单体文件的问题（例如 agent_service.py 共 880 行）。模块化设计能够提高可维护性、可测试性和支持并行开发。

### II. API 优先开发

**必须在实现之前设计和文档化 API**

每个公开功能的特性必须：
- 定义清晰的 API 契约（FastAPI 路由、数据模式）
- 使用 Pydantic 模型记录请求/响应格式
- 在 `/docs` 端点提供 OpenAPI 文档
- 遵循 RESTful HTTP 端点约定

理由：AgentMind 是一个 API 驱动的系统。清晰的契约能够支持前后端并行开发，并确保一致的集成。

### III. 使用 uv 进行依赖管理

**必须使用 uv 作为主要的 Python 包管理器**

依赖管理必须：
- 使用 `pyproject.toml` 作为唯一真实来源
- 通过 `uv sync` 安装依赖（不使用 conda 或原生 pip）
- 仅为了向后兼容性而维护 `requirements.txt`
- 使用版本约束记录所有依赖

理由：标准化使用 uv 提供更快的依赖解析、更好的可重现性，并与现代 Python 实践保持一致。

### IV. 类型安全和验证

**必须强制使用类型提示和运行时验证**

所有 Python 代码必须：
- 为函数签名和类属性包含类型提示
- 使用 Pydantic 模型进行数据验证（API 模式、配置）
- 在服务边界验证输入数据
- 从所有公开 API 返回类型化的响应

理由：类型安全能够尽早捕获错误、改进 IDE 支持，并作为活文档。Pydantic 验证防止无效数据在系统中传播。

### V. 可观测性和日志记录

**必须实现结构化日志记录以用于调试和监控**

每个服务必须：
- 使用 Loguru 实现带有上下文信息的结构化日志记录
- 在适当的级别记录日志（DEBUG、INFO、WARNING、ERROR）
- 包含时间戳、模块名称和函数上下文
- 避免记录敏感数据（API 密钥、用户凭证）

理由：AgentMind 集成多个服务（LLM、数据库、向量存储）。结构化日志记录对于调试复杂交互和监控系统健康状况至关重要。

## 技术栈约束

**栈组件：**
- **后端**：FastAPI (>=0.115)、Python 3.11+
- **前端**：React + TypeScript、Ant Design、Vite
- **LLM 框架**：LangChain 1.x (>=1.2.0)、LangGraph 用于 Agent 编排
- **数据库**：PostgreSQL（关系型）、ChromaDB（向量）、Redis（缓存）
- **部署**：Docker Compose，支持 Linux/macOS/Windows
- **包管理器**：uv（Python）、npm（JavaScript）

**约束条件：**
- Python 3.11+ 必需（用于现代类型提示和性能）
- LangChain 1.x 必需（与 0.x 版本有破坏性变更）
- Pydantic 2.x 必需（LangChain 依赖）
- 必须为前后端通信配置 CORS
- 环境变量必须通过 `.env` 文件管理（绝不硬编码）

## 开发工作流程

**特性开发流程：**

1. **规范阶段**：在 `.specify/specs/[###-feature]/spec.md` 中创建特性规范，包含用户故事和验收标准
2. **规划阶段**：在 `plan.md` 中生成实现计划，包含技术背景和结构
3. **实现阶段**：按照 `tasks.md` 中的任务列表进行实现，按用户故事优先级组织
4. **测试阶段**：先编写测试（契约测试、集成测试），确保测试失败后再实现
5. **审查阶段**：在合并前验证所有原则的遵守情况

**质量门控：**
- 所有 API 端点必须有对应的 Pydantic 数据模型
- 所有服务必须在关键决策点包含日志语句
- 所有新特性必须在相关 `.md` 文件中记录
- 所有依赖必须通过 `uv add [package]` 添加

**代码组织：**
- 后端模块在 `backend/app/[api|core|db|services|llm]/` 中
- 前端组件在 `frontend/src/[components|pages|api]/` 中
- 文档在根目录和 `.specify/` 目录中
- 脚本在 `scripts/`（bash）和根目录（部署）中

## 治理

**修订流程：**
1. 提出变更并说明理由和影响分析
2. 更新此宪章文件并升级版本号：
   - **主版本**：破坏性原则变更（例如删除或重新定义原则）
   - **次版本**：新原则添加或实质性扩展指导
   - **补丁版本**：澄清、文字修改、非语义精化
3. 更新所有相关模板和文档
4. 在文件顶部的同步影响报告（HTML 注释）中记录变更

**合规性：**
- 所有代码审查必须验证是否遵守这些原则
- 违规行为必须在 `plan.md` 的复杂性追踪部分中有合理说明
- 宪章在与其他项目实践冲突时优先

**运行时指导：**
- 开发工作流程详细信息，请参见 `.specify/templates/commands/*.md`
- 架构决策，请参见 `PROJECT_STRUCTURE.md` 和 `CODE_REFACTORING_GUIDE.md`
- API 文档，请参见运行服务器时的 `/docs` 端点

**版本**：1.0.0 | **批准日期**：2026-01-24 | **最后修改**：2026-01-24
